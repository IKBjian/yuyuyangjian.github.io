<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Story</title>
    <style>
        /* 1. 基础设置 */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #ffffee; /* 米黄色背景 */
            overflow: hidden;
            font-family: "Microsoft YaHei", sans-serif;
        }

        /* 2. 开场按钮 */
        #intro-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffee;
            z-index: 999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 1s;
        }
        
        #start-btn {
            padding: 15px 40px;
            font-size: 24px;
            color: #fff;
            background-color: #ff4081;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 64, 129, 0.4);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* 3. 画布层 */
        #treeCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }
        #fallingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 2;
            pointer-events: none;
        }

        /* 4. 左侧情话区域 */
        #text-container {
            position: absolute;
            top: 15%; 
            left: 15%; 
            width: 400px;
            z-index: 10;
            display: none;
            pointer-events: none; /* 让鼠标穿透 */
        }

        .text-line {
            font-size: 18px;
            line-height: 30px;
            color: #5d4037;
            margin-bottom: 5px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 1s;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.6);
        }

        /* === 新增：照片样式 === */
        #couple-photo {
            width: 200px; /* 照片宽度 */
            height: auto;
            border-radius: 15px; /* 圆角 */
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); /* 阴影效果 */
            border: 4px solid #fff; /* 白色边框 */
            display: none; /* 初始不显示 */
            opacity: 0; /* 初始透明 */
            transition: opacity 2s ease; /* 淡入动画时间 */
            transform: rotate(-5deg); /* 稍微倾斜一点更可爱 */
        }

        /* 5. 底部计时器区域 */
        #timer-container {
            position: absolute;
            bottom: 20px;
            left: 10%; 
            width: 80%; 
            z-index: 10;
            display: none;
            border-bottom: 4px solid #333; /* 底部粗黑线 */
            padding-bottom: 5px;
            padding-left: 5%; 
        }

        .timer-header {
            font-size: 20px;
            color: #555;
            margin-bottom: 10px;
        }
        
        .timer-header span.green {
            color: #4caf50;
            font-weight: bold;
            font-size: 24px;
        }

        .timer-numbers {
            font-family: Arial, sans-serif;
            color: #1a1a1a;
            display: flex;
            align-items: baseline;
        }

        .timer-numbers span {
            font-size: 70px;
            line-height: 1;
            margin-right: 5px;
            font-weight: 400;
        }

        .timer-unit {
            font-size: 20px;
            color: #444;
            margin-right: 20px;
        }
    </style>
</head>
<body>

    <!-- 音乐播放器 -->
    <audio id="bgm" src="river.mp3" loop preload="auto"></audio>

    <div id="intro-layer">
        <button id="start-btn">来，点我</button>
    </div>

    <canvas id="treeCanvas"></canvas>
    <canvas id="fallingCanvas"></canvas>

    <div id="text-container">
        <!-- 动态生成的文字会放在这里 -->
        
        <!-- === 新增：照片标签 (请确保你的照片命名为 us.jpg) === -->
        <img id="couple-photo" src="us.jpg" alt="Our Photo">
    </div>

    <div id="timer-container">
        <div class="timer-header">土豆女王，<span class="green">我喜欢你</span> 已经是......</div>
        <div class="timer-numbers">
            <span id="d">0</span><b class="timer-unit">天</b>
            <span id="h">00</span><b class="timer-unit">小时</b>
            <span id="m">00</span><b class="timer-unit">分钟</b>
            <span id="s">00</span><b class="timer-unit">秒</b>
        </div>
    </div>

<script>
    // ================= 配置区域 =================
    // 注意：月份是从0开始的，3代表4月。如果你是想写2025年4月25日，这里是对的。
    const startDate = new Date(2025, 3, 25, 22, 14); 

    const loveLines = [
        "这首曲子叫什么名字",
        "For River",
        "真老土，只有两个音符不停转换。",
        "Re，mi",
        "Remember me, 玉玉",
    ];
    // ===========================================

    const treeCanvas = document.getElementById('treeCanvas');
    const fallingCanvas = document.getElementById('fallingCanvas');
    const ctx = treeCanvas.getContext('2d');
    const fCtx = fallingCanvas.getContext('2d');

    let width, height;
    let branches = [];
    let treeLeaves = [];
    let fallingLeaves = [];

    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        treeCanvas.width = width;
        treeCanvas.height = height;
        fallingCanvas.width = width;
        fallingCanvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    document.getElementById('start-btn').addEventListener('click', function() {
        // 1. 播放音乐
        const audio = document.getElementById('bgm');
        audio.play().catch(function(error) {
            console.log("音乐播放失败");
        });

        // 2. 隐藏开场
        document.getElementById('intro-layer').style.opacity = 0;
        setTimeout(() => document.getElementById('intro-layer').style.display = 'none', 1000);

        // 3. 显示UI
        document.getElementById('text-container').style.display = 'block';
        document.getElementById('timer-container').style.display = 'block';

        // 4. 启动动画
        initTree(); 
        loopTree(); 
        loopFalling(); 
        startTimer(); 
        startTypeWriter(); 
    });

    // ----------------- 1. 树的生长逻辑 -----------------
    function Branch(x, y, angle, width, life) {
        this.x = x;
        this.y = y;
        this.angle = angle;
        this.width = width;
        this.life = life;
        this.speed = 3;
    }

    function initTree() {
        const rootX = width * 0.72; 
        const rootY = height - 20; 
        const initialLength = height * 0.12;
        branches.push(new Branch(rootX, rootY, Math.PI / 2, 20, initialLength));
    }

    function drawHeart(context, x, y, size, color) {
        context.save();
        context.translate(x, y);
        context.scale(size/10, size/10);
        context.beginPath();
        context.moveTo(0, 0);
        context.bezierCurveTo(-5, -5, -10, 0, 0, 10);
        context.bezierCurveTo(10, 0, 5, -5, 0, 0);
        context.fillStyle = color;
        context.fill();
        context.restore();
    }

    function getRandomColor() {
        const colors = ['#ff9a9e', '#ff6b6b', '#ff4081', '#ffc107', '#ffcc80'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    function loopTree() {
        if (branches.length > 0) {
            for (let i = branches.length - 1; i >= 0; i--) {
                const b = branches[i];
                const nextX = b.x - Math.cos(b.angle) * b.speed;
                const nextY = b.y - Math.sin(b.angle) * b.speed;

                ctx.beginPath();
                ctx.moveTo(b.x, b.y);
                ctx.lineTo(nextX, nextY);
                ctx.strokeStyle = '#3e2723';
                ctx.lineWidth = b.width;
                ctx.lineCap = 'round';
                ctx.stroke();

                b.x = nextX; b.y = nextY; b.life -= 1;

                if (b.life <= 0) {
                    branches.splice(i, 1);
                    if (b.width > 2) {
                        const nextLife = b.width * 2.4 + Math.random() * 8;
                        branches.push(new Branch(b.x, b.y, b.angle - 0.25 - Math.random()*0.25, b.width*0.7, nextLife));
                        branches.push(new Branch(b.x, b.y, b.angle + 0.25 + Math.random()*0.25, b.width*0.7, nextLife));
                    } else {
                        treeLeaves.push({
                            x: b.x, y: b.y, size: 0, maxSize: 6 + Math.random() * 8, color: getRandomColor()
                        });
                    }
                }
            }
        }

        if (treeLeaves.length > 0) {
            for (let i = treeLeaves.length - 1; i >= 0; i--) {
                const l = treeLeaves[i];
                if (l.size < l.maxSize) {
                    l.size += 0.5;
                    drawHeart(ctx, l.x, l.y, l.size, l.color);
                    if (l.size >= l.maxSize) {
                        treeLeaves.splice(i, 1);
                        drawHeart(ctx, l.x, l.y, l.size, l.color); 
                    }
                }
            }
        }
        requestAnimationFrame(loopTree);
    }

    // ----------------- 2. 飘落爱心逻辑 -----------------
    function FallingHeart() {
        this.x = Math.random() * (width * 0.6) + (width * 0.4);
        this.y = -20; 
        this.size = Math.random() * 10 + 10;
        this.speedX = Math.random() * 1 + 0.5; 
        this.speedY = Math.random() * 1.5 + 1; 
        this.color = getRandomColor();
        this.rotation = Math.random() * Math.PI * 2;
        this.swing = Math.random() * 0.1; 
    }

    function loopFalling() {
        fCtx.clearRect(0, 0, width, height);

        if (Math.random() < 0.03) { 
            fallingLeaves.push(new FallingHeart());
        }

        for (let i = fallingLeaves.length - 1; i >= 0; i--) {
            const f = fallingLeaves[i];
            
            f.x -= f.speedX + Math.sin(f.y * 0.01) * 0.5; 
            f.y += f.speedY;
            f.rotation += f.swing;

            fCtx.save();
            fCtx.translate(f.x, f.y);
            fCtx.rotate(f.rotation);
            drawHeart(fCtx, 0, 0, f.size, f.color);
            fCtx.restore();

            if (f.y > height || f.x < 0) {
                fallingLeaves.splice(i, 1);
            }
        }
        requestAnimationFrame(loopFalling);
    }

    // ----------------- 3. 文字 & 计时器 & 照片显示逻辑 -----------------

    function startTypeWriter() {
        let lineIndex = 0;
        const container = document.getElementById('text-container');
        
        function typeLine() {
            if (lineIndex < loveLines.length) {
                const div = document.createElement('div');
                div.className = 'text-line';
                div.innerText = loveLines[lineIndex];
                container.insertBefore(div, document.getElementById('couple-photo')); // 插入在图片之前
                setTimeout(() => div.style.opacity = 1, 100);
                lineIndex++;
                setTimeout(typeLine, 1500); 
            } else {
                // === 所有文字显示完毕，显示照片 ===
                showPhoto();
            }
        }
        setTimeout(typeLine, 1000);
    }

    function showPhoto() {
        const photo = document.getElementById('couple-photo');
        // 先让它占位 (display block)
        photo.style.display = 'block';
        // 稍微延迟一点点加透明度，触发 CSS transition 效果
        setTimeout(() => {
            photo.style.opacity = 1;
        }, 100);
    }

    function startTimer() {
        function update() {
            const now = new Date();
            const diff = now - startDate;
            // 注意：因为开始时间是2025年，如果现在时间早于开始时间，diff会是负数
            // 这里我们取绝对值或者如果需要倒计时，逻辑稍微不同。
            // 假设是“已经是”多少天，通常指过去。如果2025是未来，这里会显示负数。
            // 如果你是想算倒计时（还要多久），请告诉我。这里按原样显示。
            
            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('d').innerText = d;
            document.getElementById('h').innerText = String(h).padStart(2, '0');
            document.getElementById('m').innerText = String(m).padStart(2, '0');
            document.getElementById('s').innerText = String(s).padStart(2, '0');
        }
        setInterval(update, 1000);
        update();
    }

</script>
</body>
</html>